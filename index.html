<!doctype html>
<html lang="fr" class="no-js">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="css/style.css"> <!-- Resource style -->
	<script src="js/modernizr.js"></script> <!-- Modernizr -->

	<!-- FAVICON -->
	<link rel="icon" href="img/logoIMSSA.ico" type="image/x-icon">

	<title>Site IMSSA | Test</title>
</head>

<body>
	<header>
		<div class="navbar">
			<div>
				<a href="index.html" class="nav__logo">
					<img src="img/logoIMSSA.ico" alt="logo IMSSA" id="logo_header"> IMSSA accueil
				</a>
			</div>
			<div class="cd-dropdown-wrapper">

				<a href="menu.html" id="btn-fav" class="navbar-btn">‚ù§Ô∏è</a>
				<a href="#0" id="btn-google" class="navbar-btn">üîí</a>

				<!--		 DROPDOWN		 -->
				<a class="cd-dropdown-trigger" href="#0">Menu</a>
				<nav class="cd-dropdown">
					<h2>Menu</h2>
					<a href="#0" class="cd-close">Fermer</a>
					<ul class="cd-dropdown-content">

						<li class="cd-divider">Exercices</li>

						<li id="menu"></li>

						<li class="cd-divider">Autre</li>

						<li class="has-children">
							<a href="http://codyhouse.co/?p=748">Contact</a>
							<ul class="cd-dropdown-icons is-hidden">
								<li class="go-back"><a href="#0">Contact</a></li>
								<li>
									<a class="cd-dropdown-item item-1" href="http://codyhouse.co/?p=748">
										<h3>Instagram</h3>
										<p>This is the item description</p>
									</a>
								</li>

								<li>
									<a class="cd-dropdown-item item-2" href="http://codyhouse.co/?p=748">
										<h3>TikTok</h3>
										<p>This is the item description</p>
									</a>
								</li>

								<li>
									<a class="cd-dropdown-item item-3" href="http://codyhouse.co/?p=748">
										<h3>Mail</h3>
										<p>This is the item description</p>
									</a>
								</li>

								<li>
									<a class="cd-dropdown-item item-4" href="http://codyhouse.co/?p=748">
										<h3>MonRdvKin√©</h3>
										<p>This is the item description</p>
									</a>
								</li>

								<li>
									<a class="cd-dropdown-item item-5" href="http://codyhouse.co/?p=748">
										<h3>T√©l√©phone</h3>
										<p>This is the item description</p>
									</a>
								</li>

								<li>
									<a class="cd-dropdown-item item-6" href="http://codyhouse.co/?p=748">
										<h3>Google Map</h3>
										<p>This is the item description</p>
									</a>
								</li>

							</ul> <!-- .cd-dropdown-icons -->
						</li> <!-- .has-children -->
					</ul> <!-- .cd-dropdown-content -->
				</nav> <!-- .cd-dropdown -->
			</div> <!-- .cd-dropdown-wrapper -->
		</div>

	</header>

	<!--			 MAIN			 -->

	<main class="cd-main-content">
		<h1>Bienvenue dans le site web IMSSA</h1>
		<img src="img/cabinet.webp" alt="cabinet IMSSA" id="image-cabinet">

	</main>


	<!--			 MAIN			 -->

	<script src="js/jquery-2.1.1.js"></script>
	<script src="js/jquery.menu-aim.js"></script> <!-- menu aim -->
	<script src="js/main.js"></script> <!-- Resource jQuery -->

	<footer class="site-footer">
		<p>&copy; Cabinet Kin√©</p>
	</footer>


	<script>
		fetch("videos.json")
			.then(res => res.json())
			.then(data => {
				const menu = document.getElementById("menu");

				// Boucle sur les 3 grandes cat√©gories
				for (const grandCategorie in data) {
					const li = document.createElement("li");
					li.classList.add("has-children");

					// Nom de la grande cat√©gorie
					li.innerHTML = `<a href="#0">${grandCategorie}</a>`;

					// Sous-menu principal
					const ulSecond = document.createElement("ul");
					ulSecond.classList.add("cd-secondary-dropdown", "is-hidden");
					ulSecond.innerHTML = `
        <li class="go-back"><a href="#0">Menu</a></li>
        <li class="see-all"><a href="cat√©gories/${grandCategorie}.html">Tous les exercices</a></li>
      `;

					// R√©cup√©rer les sous-cat√©gories
					const sousCategories = data[grandCategorie];
					for (const sousCat in sousCategories) {
						const liSous = document.createElement("li");
						liSous.classList.add("has-children");
						liSous.innerHTML = `<a href="#0">${sousCat}</a>`;

						// Sous-sous-menu (vid√©os de la sous-cat√©gorie)
						const ulVideos = document.createElement("ul");
						ulVideos.classList.add("is-hidden");
						ulVideos.innerHTML = `
          <li class="go-back"><a href="#0">Retour</a></li>
          <li class="see-all"><a href="cat√©gories/${grandCategorie}-${sousCat}.html">Voir tout</a></li>
        `;

						// Les vid√©os de la sous-cat√©gorie
						sousCategories[sousCat].forEach(video => {
							const liVideo = document.createElement("li");
							liVideo.innerHTML = `<a href="${video.url}" target="_blank">${video.titre}</a>`;
							ulVideos.appendChild(liVideo);
						});

						liSous.appendChild(ulVideos);
						ulSecond.appendChild(liSous);
					}

					li.appendChild(ulSecond);
					menu.appendChild(li);
				}
			});
	</script>





	<script type="module">
		// 1) Imports Firebase (v12 modules)
		import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
		import {
			getAuth,
			onAuthStateChanged,
			signInWithPopup,
			GoogleAuthProvider,
			signOut
		} from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
		import {
			getFirestore,
			doc,
			getDoc,
			setDoc
		} from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

		// 2) Ta config Firebase (copi√©e depuis la console > CDN > Compat ou Modules)
		const firebaseConfig = {
			apiKey: "AIzaSyA7r18GtsCIi1n2AoaBFG-lAYyBPXFIw4Q",
			authDomain: "imssa-2d3cb.firebaseapp.com",
			projectId: "imssa-2d3cb",
			storageBucket: "imssa-2d3cb.appspot.com",
			messagingSenderId: "976927404721",
			appId: "1:976927404721:web:3484dd21e9e52a1e692890",
			measurementId: "G-SKTEPM9LKC"
		};

		// 3) Initialisation Firebase
		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
		const db = getFirestore(app);

		// 4) Gestion du bouton Google Sign-In / Sign-Out
		const btnGoogle = document.getElementById("btn-google");
		btnGoogle.addEventListener("click", () => {
			if (!auth.currentUser) {
				signInWithPopup(auth, new GoogleAuthProvider()).catch(console.error);
			} else {
				signOut(auth).catch(console.error);
			}
		});

		// 5) √âcoute de l‚Äô√©tat de connexion et initialisation des boutons ‚ù§Ô∏è/ü©∂
		const largeurEcran = window.innerWidth; // Largeur de l'√©cran visible
		onAuthStateChanged(auth, async user => {
			if (user) {
				if (largeurEcran > 1024) {
					btnGoogle.textContent = `üë§ ${user.displayName}`;
				} else {
					btnGoogle.textContent = `üë§`;
				}
				// R√©cup√®re les favoris dans Firestore
				const ref = doc(db, "users", user.uid);
				const snap = await getDoc(ref);
				const favs = snap.exists() ? snap.data().favoris : [];
				initButtons(favs, user.uid);
			} else {
				btnGoogle.textContent = "üîí";
				initButtons([], null);
			}
		});

		// 6) Fonctions de gestion des favoris
		async function toggleFavori(id, label, btn, uid) {
			if (!uid) {
				alert("Connectez-vous d‚Äôabord pour g√©rer vos favoris.");
				return;
			}
			const ref = doc(db, "users", uid);
			const snap = await getDoc(ref);
			let favs = snap.exists() ? snap.data().favoris : [];
			const idx = favs.findIndex(f => f.id === id);
			if (idx !== -1) favs.splice(idx, 1);
			else favs.push({ id, label });
			// Sauvegarde en base
			await setDoc(ref, { favoris: favs }, { merge: true });
			// Mise √† jour du bouton
			btn.textContent = idx !== -1 ? "ü©∂" : "‚ù§Ô∏è";
		}

		function initButtons(favs, uid) {
			document.querySelectorAll(".fav-btn").forEach(btn => {
				const { id, label } = btn.dataset;
				btn.textContent = favs.some(f => f.id === id) ? "‚ù§Ô∏è" : "ü©∂";
				btn.onclick = () => toggleFavori(id, label, btn, uid);
			});
		}
	</script>
</body>

</html>
